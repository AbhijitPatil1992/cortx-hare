* Hare - Halon replacement

** The "Fortnight" Prototype (due 2019-Jul-15)

We are able to start and stop m0d services in EOS configuration (aka
"1+0" configuration): 1 data unit, no parity units, 2 hosts or 1 host.
Halon is not used.

Some amount of fault tolerance is required. (If we decided to go quick
and fragile way of not supporting failures in the prototype, we
wouldn't need Consul to achieve this.  But the whole point of this
prototyping exercise is prove that Mero cluster can work without
Halon.)

*** [@andriy] RC

- RC - Recovery Coordinator
- EQ - Event Queue
- BQ - Broadcast Queue (HA notifications)

*** [@vvv] initial cluster configuration

**** m0cluster.yaml

Host names, IP addresses, disks specification, where to run confd, RM,
IO services.  Something similar to the ~m0genfacts~' "mini config"
file format.

**** collect-facts

- in: m0cluster.yaml
- out: m0cluster-facts/*.json

*collect-facts* script reads m0cluster.yaml, ssh-es to the hosts
mentioned in it, collects configuration data needed for conf.xc
(e.g., ~facter --json processors | jq .processors.count~,
~facter memorysize_mb~) and saves this data in local files.

**** genconf

- in: m0cluster-facts/*.json
- out: conf.xc; Consul KV

*genconf* builds internal representation of Mero conf graph from
m0cluster-facts data and creates ~conf.xc~ file(s).

*** [@dima.c] bootstrapping: Ansible or Salt

**** start/stop m0d services

Prepare configuration files in ~/etc/~, those will be used by systemd.

*** [@mandar] entrypoint server

~m0ham~-based.  Static replies will do.  Bonus points for getting this
data from Consul KV.

*** [@kostya] HA notifications

We need those for EES.

*** fault tolerance

Handle failures of m0d processes.  Consul watcher to trigger Pacemaker
to do failover?

*** ? fid generator

**** ? option 1: use the [[https://docs.google.com/document/d/1-td9_sO-bqErDtJYx40J9UEp2zJh4JJUp_yPmm9Knuc/edit][UFID generator]] (the one used by the s3server team)

It generates only 20 bits of a ~m0_fid~.

**** option 2: the RC increments some counter field in the KV

***** Consul has some atomic increments ([[https://en.wikipedia.org/wiki/Compare-and-swap][CAS]])

*** m0d heartbeats

Do we want to utilize ~ha_link~ or come with a simpler mechanism?

*** ? rg2kv

We might want to store subset of Halon's resource graph in Consul KV.

** work distribution; Jira tickets

*** 'hare' prototype work

**** @andriy - [[https://jts.seagate.com/browse/EOS-689][EOS-689]] ~m0sk~: design and prototype the RC replacement

**** @vvv - [[https://jts.seagate.com/browse/EOS-690][EOS-690]] initial cluster configuration

Dhall-elujah!

***** @prasanna - [[https://jts.seagate.com/browse/EOS-717][EOS-717]] ~Obj~ definitions in m0conf.dhall

**** @mandar - [[https://jts.seagate.com/browse/EOS-691][EOS-691]] entrypoint server

m0ham-based

**** @dima.c - [[https://jts.seagate.com/browse/EOS-692][EOS-692]] bootstrapping

Ansible

**** @kostya - [[https://jts.seagate.com/browse/EOS-693][EOS-693]] fid generator

UFID application

*** 'hare' scoping work

This document.
